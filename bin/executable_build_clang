#!/bin/bash

set -euo pipefail

cmake -G Ninja \
  -DCMAKE_BUILD_TYPE=Release \
  -DCMAKE_CXX_FLAGS="-gmlt" \
  -DCMAKE_C_FLAGS="-gmlt" \
  -DCMAKE_INSTALL_PREFIX=$HOME/tmp/llvm \
  -DCMAKE_EXPORT_COMPILE_COMMANDS=1 \
  -DLLVM_USE_LINKER=lld \
  -DLLVM_ENABLE_ASSERTIONS=On \
  -DLLVM_ENABLE_PROJECTS='libcxx;clang;libcxxabi;lld;compiler-rt' \
  -DCMAKE_C_COMPILER_LAUNCHER=$(which gomacc) \
  -DCMAKE_CXX_COMPILER_LAUNCHER=$(which gomacc) \
  -DCMAKE_C_COMPILER=$HOME/chromium-clang/bin/clang \
  -DCMAKE_CXX_COMPILER=$HOME/chromium-clang/bin/clang++ \
  ../llvm

